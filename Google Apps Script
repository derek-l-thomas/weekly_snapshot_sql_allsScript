function fetchWeeklySnapshot() {
  var scriptProperties = PropertiesService.getScriptProperties();
  
  // Retrieves the database connection details from the script properties
  var dbUrl = scriptProperties.getProperty('DB_URL');  
  var user = scriptProperties.getProperty('DB_USER');  
  var userPwd = scriptProperties.getProperty('DB_PASS'); 

  var conn = Jdbc.getConnection(dbUrl, user, userPwd);
  var stmt = conn.createStatement();

  var sql = `
    SELECT 
        CURRENT_DATE() AS snapshot_date,
        IFNULL(engagement_status, 'NULL') AS engagement_status,
        IFNULL(ladder_engagement, 'NULL') AS ladder_engagement,
        COUNT(*) AS count
    FROM 
        salesforce_contacts
    GROUP BY 
        engagement_status, 
        ladder_engagement;
  `;

  var results = stmt.executeQuery(sql);
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  var data = [];
  while (results.next()) {
    data.push([
      results.getString('snapshot_date'), 
      results.getString('engagement_status'),
      results.getString('ladder_engagement'), 
      results.getInt('count')
    ]);
  }

  if (data.length > 0) {
    var startRow = sheet.getLastRow() + 1;
    var range = sheet.getRange(startRow, 1, data.length, 4);
    range.setValues(data);
  }
  
  stmt.close();
  conn.close();
}
